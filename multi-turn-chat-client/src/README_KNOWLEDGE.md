# 知识库引用功能说明

## 功能概述

本次更新为聊天应用添加了完整的知识库文档引用功能，支持项目级和会话级的文档引用管理。

## 界面布局变更

### 四列布局结构
原有的三列布局（项目列、会话列、聊天列）扩展为四列：

1. **项目列** (120px) - 显示所有项目
2. **会话列** (200px) - 显示当前项目下的会话（宽度从250px压缩至200px）
3. **知识库列** (120px) - 新增，显示当前会话的引用文档
4. **聊天列** (自适应) - 聊天对话区域

## 知识库功能特性

### 1. 文档引用层级
- **项目级引用**：项目引用的文档对该项目下所有会话生效
- **会话级引用**：仅对特定会话生效，不能与项目级引用重复

### 2. 知识库面板
- 实时显示当前会话的引用文档
- 分为"项目级引用"和"会话级引用"两个区域
- 点击文档名称可查看和编辑文档内容
- 点击区域标题可编辑引用设置

### 3. 文档管理功能
- **查看文档**：点击文档名称打开详情弹窗
- **编辑文档**：支持修改文件名和内容，自动创建新版本
- **引用管理**：通过弹窗界面选择要引用的文档

## 组件架构

### 新增组件
1. **KnowledgePanel** - 知识库面板主组件
2. **DocumentDetailModal** - 文档详情查看/编辑弹窗
3. **ProjectReferenceModal** - 项目级引用编辑弹窗
4. **ConversationReferenceModal** - 会话级引用编辑弹窗

### 新增Hook
1. **useKnowledgeReferences** - 管理会话引用文档状态
2. **useKnowledgeDocuments** - 管理知识库文档列表
3. **useProjectReferences** - 管理项目级引用
4. **useConversationReferences** - 管理会话级引用

### API接口
新增了完整的知识库引用API支持：
- 查询会话引用文档
- 获取知识库文档列表
- 管理项目级/会话级引用
- 文档详情查看和编辑

## 使用流程

### 1. 查看引用文档
1. 选择一个会话
2. 在知识库面板查看该会话的引用文档
3. 点击文档名称查看详细内容

### 2. 编辑项目级引用
1. 点击"项目级引用"标题
2. 在弹窗中选择要引用的知识库文档
3. 保存设置，影响项目下所有会话

### 3. 编辑会话级引用
1. 点击"会话级引用"标题
2. 选择要引用的文档（排除项目级已引用的）
3. 保存设置，仅影响当前会话

### 4. 编辑文档内容
1. 点击任意文档名称
2. 在详情弹窗中点击"编辑"
3. 修改文件名或内容后保存

## 技术实现要点

### 1. 布局优化
- 压缩会话列宽度以容纳知识库面板
- 调整聊天区域样式以适应更紧凑的空间
- 优化滚动条和间距

### 2. 状态管理
- 使用专门的Hook管理知识库相关状态
- 实现引用关系的实时更新和刷新
- 处理项目级和会话级引用的互斥关系

### 3. 用户体验
- 支持键盘快捷键操作
- 提供清晰的视觉反馈和错误提示
- 响应式设计适配不同屏幕尺寸

### 4. 数据一致性
- 确保引用关系的正确性
- 防止重复引用
- 实时同步引用状态变更

## 样式调整

为适应四列布局，对以下样式进行了优化：
- 减少聊天消息的内边距和字体大小
- 压缩控制按钮和输入框尺寸
- 优化滚动条样式
- 调整整体间距和布局比例

这些调整确保在有限的屏幕空间内提供良好的用户体验。